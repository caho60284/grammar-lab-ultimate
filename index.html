<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>English Grammar Analyzer</title>

<style>
body{
font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial;
background:#f4f6f5;
margin:0;
padding:20px;
display:flex;
justify-content:center;
}
.container{width:100%;max-width:720px;}
h1{font-size:32px;margin:10px 0;color:#2f4f46;}
.subtitle{color:#7b8f88;margin-bottom:20px;}

textarea{
width:100%;
border-radius:16px;
border:2px solid #d5dfda;
padding:16px;
font-size:18px;
resize:none;
box-sizing:border-box;
}

button{
width:100%;
margin-top:16px;
padding:16px;
border:none;
border-radius:20px;
background:#557c6e;
color:white;
font-size:20px;
cursor:pointer;
}

.card{
background:white;
border-radius:20px;
padding:20px;
margin-top:20px;
box-shadow:0 4px 12px rgba(0,0,0,0.05);
}

.block{
background:#eef2ef;
border-radius:14px;
padding:14px;
margin-top:12px;
line-height:1.5;
}

.stars{color:#f5b301;font-size:20px;}

</style>
</head>

<body>
<div class="container">
<h1>üß† English Grammar Analyzer</h1>
<div class="subtitle">Struktur + POS + tense + naturalness + AI</div>

<textarea id="input" rows="3"></textarea>
<button onclick="analyze()">Analyze</button>

<div id="result"></div>
</div>

<script>

const modals=["can","could","will","would","shall","should","may","might","must"];

function tokenize(s){
return s
.replace(/[.,!?]/g,"")
.split(/\s+/)
.map(w=>w.toLowerCase());
}

function detectSubject(words){
return words[0];
}

function detectModal(words){
for(let w of words){
let base=w.replace("n't","");
if(modals.includes(base)) return base;
}
return "-";
}

function detectVerb(words){
for(let i=0;i<words.length;i++){
let w=words[i].replace("n't","");
if(modals.includes(w)){
return words[i+1] || "-";
}
}
return words[1] || "-";
}

function detectObject(words){
if(words.length<3) return "-";

let start=1;
if(modals.includes(words[1]?.replace("n't",""))) start=2;

return words.slice(start+1).join(" ") || "-";
}

function detectClause(sentence){
let low=sentence.toLowerCase();
if(low.includes("because")) return sentence.split(/because/i)[1].trim();
if(low.includes("when")) return sentence.split(/when/i)[1].trim();
if(low.includes("if")) return sentence.split(/if/i)[1].trim();
return "-";
}

function detectTense(words){
for(let w of words){
let base=w.replace("n't","");
if(["could","would","should","might"].includes(base)) return "modal past";
}
return "present";
}

function naturalness(words){
if(words.length>=8) return 5;
if(words.length>=5) return 4;
return 3;
}

async function translate(text){
try{
let res=await fetch("https://libretranslate.de/translate",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({q:text,source:"en",target:"id"})
});
let data=await res.json();
if(data.translatedText) return data.translatedText;
}catch(e){}
return "(terjemahan gagal)";
}

async function analyze(){

const raw=document.getElementById("input").value.trim();
if(!raw) return;

const words=tokenize(raw);

const subject=detectSubject(words);
const modal=detectModal(words);
const verb=detectVerb(words);
const object=detectObject(words);
const clause=detectClause(raw);
const tense=detectTense(words);
const nat=naturalness(words);
const translation=await translate(raw);

document.getElementById("result").innerHTML=`
<div class="card">

<div style="font-size:22px;margin-bottom:12px">
${raw}
</div>

<div><b>Arti:</b> ${translation}</div>

<div class="block">
<b>Subject:</b> ${subject}<br>
<b>Modal:</b> ${modal}<br>
<b>Verb:</b> ${verb}<br>
<b>Object:</b> ${object}<br>
<b>Clause:</b> ${clause}<br>
<b>Tense:</b> ${tense}
</div>

<div style="margin-top:12px">
<b>Naturalness:</b> <span class="stars">${"‚≠ê".repeat(nat)}</span>
</div>

<div style="margin-top:10px">
<b>Native:</b> ${raw}
</div>

</div>
`;
}
</script>
</body>
</html>