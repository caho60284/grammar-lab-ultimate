<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Grammar Lab Ultimate</title>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial;
  background:#f4f6f5;
  margin:0;
  padding:20px;
  display:flex;
  justify-content:center;
}
.container{
  width:100%;
  max-width:760px;
}
h1{
  margin:8px 0 14px;
  color:#2f4f46;
}
textarea{
  width:100%;
  border-radius:14px;
  border:2px solid #d5dfda;
  padding:14px;
  font-size:18px;
  resize:none;
  box-sizing:border-box;
}
button{
  width:100%;
  margin-top:14px;
  padding:14px;
  border:none;
  border-radius:16px;
  background:#557c6e;
  color:#fff;
  font-size:18px;
}
.card{
  background:#fff;
  border-radius:16px;
  padding:16px;
  margin-top:16px;
  box-shadow:0 4px 10px rgba(0,0,0,.05);
}
.block{
  background:#eef2ef;
  border-radius:12px;
  padding:12px;
  margin-top:10px;
  line-height:1.5;
}
.stars{
  color:#f5b301;
  font-size:18px;
}
</style>
</head>

<body>
<div class="container">

<h1>üß† Grammar Lab Ultimate</h1>

<textarea id="input" rows="3" placeholder="Type sentence..."></textarea>
<button onclick="analyze()">Analyze</button>

<div id="result"></div>

</div>

<script>

/* =========================
   TRANSLATOR ‚Äî VOCAB ENGINE
   ========================= */
async function translateENtoID(text){
  try{
    const r = await fetch(
      "https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=id&dt=t&q=" 
      + encodeURIComponent(text)
    )
    const j = await r.json()
    return j[0]?.map(x=>x[0]).join("") || ""
  }catch{
    return "(terjemahan gagal)"
  }
}

/* =========================
   TOKENIZER
   ========================= */
function tokenize(s){
  return s
    .replace(/[.,!?]/g,"")
    .split(/\s+/)
    .map(w=>w.toLowerCase())
}

/* =========================
   GRAMMAR DETECTION
   ========================= */
const modals=["can","could","will","would","shall","should","may","might","must"]

function detectSubject(words){
  return words[0] || "-"
}

function detectModal(words){
  for(let w of words){
    let base=w.replace("n't","")
    if(modals.includes(base)) return base
  }
  return "-"
}

function detectVerb(words){
  for(let i=0;i<words.length;i++){
    let w=words[i].replace("n't","")
    if(modals.includes(w)){
      return words[i+1] || "-"
    }
  }
  return words[1] || "-"
}

function detectObject(words){
  if(words.length<3) return "-"
  let start=1
  if(modals.includes(words[1]?.replace("n't",""))) start=2
  return words.slice(start+1).join(" ") || "-"
}

function detectClause(sentence){
  let s=sentence.toLowerCase()
  if(s.includes("because")) return sentence.split(/because/i)[1].trim()
  if(s.includes("when")) return sentence.split(/when/i)[1].trim()
  if(s.includes("if")) return sentence.split(/if/i)[1].trim()
  if(s.includes("that")) return sentence.split(/that/i)[1].trim()
  return "-"
}

function detectTense(words){
  for(let w of words){
    let base=w.replace("n't","")
    if(["could","would","should","might"].includes(base)) return "modal past"
  }
  if(words.includes("will")) return "future"
  if(words.includes("am")||words.includes("is")||words.includes("are")) return "present"
  return "present"
}

function naturalness(words){
  if(words.length>=8) return 5
  if(words.length>=5) return 4
  return 3
}

/* =========================
   ANALYZE
   ========================= */
async function analyze(){

  const raw = document.getElementById("input").value.trim()
  if(!raw) return

  const words = tokenize(raw)

  const subject = detectSubject(words)
  const modal   = detectModal(words)
  const verb    = detectVerb(words)
  const object  = detectObject(words)
  const clause  = detectClause(raw)
  const tense   = detectTense(words)
  const nat     = naturalness(words)

  const arti = await translateENtoID(raw)

  document.getElementById("result").innerHTML = `
  <div class="card">

    <div style="font-size:20px;margin-bottom:8px">${raw}</div>

    <div><b>Arti:</b> ${arti || "(terjemahan gagal)"}</div>

    <div class="block">
      <b>Subject:</b> ${subject}<br>
      <b>Modal:</b> ${modal}<br>
      <b>Verb:</b> ${verb}<br>
      <b>Object:</b> ${object}<br>
      <b>Clause:</b> ${clause}<br>
      <b>Tense:</b> ${tense}
    </div>

    <div style="margin-top:10px">
      <b>Naturalness:</b> <span class="stars">${"‚≠ê".repeat(nat)}</span>
    </div>

  </div>
  `
}

</script>
</body>
</html>