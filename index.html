<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Grammar Lab</title>

<style>
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif}
body{margin:0;background:#f4f8f6}
header{background:#fff;padding:16px;box-shadow:0 2px 6px rgba(0,0,0,.06)}
h1{margin:0;color:#1f7a5c}
.sub{font-size:13px;color:#6b7280}

.container{padding:16px;max-width:900px;margin:auto}

textarea{
width:100%;
min-height:110px;
padding:12px;
border-radius:12px;
border:1px solid #ddd;
font-size:16px;
}

button{
margin-top:10px;
background:#1f7a5c;
color:#fff;
border:none;
border-radius:10px;
padding:10px 14px;
font-size:15px;
cursor:pointer;
}

.card{
background:#fff;
border-radius:14px;
padding:14px;
margin-top:14px;
box-shadow:0 2px 6px rgba(0,0,0,.05);
}

.title{font-weight:700;color:#1f7a5c;margin-bottom:6px}
.issue{color:#c0392b;margin:3px 0}
.good{color:#1f7a5c}
.suggestion{
background:#ecfdf5;
padding:10px;
border-radius:10px;
margin-top:6px;
font-style:italic;
}
</style>
</head>

<body>

<header>
<h1>üß† Grammar Lab</h1>
<div class="sub">Grammar analyzer + rewrite + meaning</div>
</header>

<div class="container">

<textarea id="sentence" placeholder="Ketik atau tempel kalimat Inggris..."></textarea>
<button onclick="analyze()">Analisis</button>

<div id="syntax" class="card" style="display:none"></div>
<div id="issues" class="card" style="display:none"></div>
<div id="rewrite" class="card" style="display:none"></div>
<div id="meaning" class="card" style="display:none"></div>

</div>

<script>

// ===== UTIL =====
function cap(s){
return s.charAt(0).toUpperCase()+s.slice(1)
}

// ===== TRANSLATE =====
async function translateToIndo(text){
try{
let r=await fetch("https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=id&dt=t&q="+encodeURIComponent(text))
let j=await r.json()
return j[0].map(x=>x[0]).join("")
}catch{return ""}
}

// ===== ANALYZE =====
function analyze(){

let text=document.getElementById("sentence").value.trim()
if(!text) return

let lower=text.toLowerCase()
let issues=[]
let sug=text

function add(msg){issues.push(msg)}

// ===== SUBJECT / VERB =====
let tokens=lower.replace(/[.,!?]/g,"").split(/\s+/)
let subject=tokens[0]||""
let verb=tokens[1]||""

// ===== SYNTAX =====
let syntaxBox=document.getElementById("syntax")
syntaxBox.innerHTML="<div class='title'>Syntax</div>"+
"Subject: "+subject+"<br>Main verb: "+verb
syntaxBox.style.display="block"

// ===== INFINITIVE VERBS =====
let infinitive=["want","need","plan","decide","try","hope","learn","refuse"]
infinitive.forEach(v=>{
let nounAfter=new RegExp("\\b"+v+"\\s+(something|someone|anything|nothing|a|an|the)\\b")
let wrong=new RegExp("\\b"+v+"\\s+[a-z]+\\b")
if(wrong.test(lower)&&!new RegExp("\\b"+v+"\\s+to\\s+").test(lower)&&!nounAfter.test(lower)){
add('Verb complement: "'+v+'" harus diikuti to + verb')
sug=sug.replace(new RegExp(v+"\\s+([a-z]+)","i"),v+" to $1")
}
})

// ===== SOMETHING TO VERB =====
if(/\b(something|anything|nothing|someone)\s+[a-z]+\b/.test(lower) &&
!/\b(something|anything|nothing|someone)\s+to\s+[a-z]+\b/.test(lower)){
add('Setelah something/someone perlu "to + verb"')
sug=sug.replace(/\b(something|anything|nothing|someone)\s+([a-z]+)/i,"$1 to $2")
}

// ===== MODAL + ING =====
let modals=["will","can","must","should","may","might","could","would"]
modals.forEach(m=>{
if(new RegExp("\\b"+m+"\\s+[a-z]+ing\\b").test(lower)){
add("Modal harus diikuti base verb")
sug=sug.replace(new RegExp(m+"\\s+([a-z]+)ing","i"),m+" $1")
}
})

// ===== FEEL + ING =====
if(/\bfeel\s+[a-z]+ing\b/.test(lower)&&!/\bfeel\s+like\s+[a-z]+ing\b/.test(lower)){
add('Verb complement: feel harus "like + ing"')
sug=sug.replace(/\bfeel\s+([a-z]+ing)/i,"feel like $1")
}

// ===== FALL + ING =====
if(/\bfell\s+[a-z]+ing\b/.test(lower)&&!/\bfell\s+(while|and)\s+[a-z]+ing\b/.test(lower)){
add('Setelah "fell" biasanya perlu while/and sebelum -ing')
sug=sug.replace(/\bfell\s+([a-z]+ing)/i,"fell while $1")
}

// ===== ANYTHING POLARITY =====
if(/\banything\b/.test(lower)&&!/\bnot|never|n't\b/.test(lower)){
add("Gunakan something dalam kalimat positif")
sug=sug.replace(/anything/i,"something")
}

// ===== NEED SOMETHING TO EAT =====
if(/\bneed\s+(something|anything|nothing|someone)\s+[a-z]+\b/.test(lower)&&
!/\bneed\s+(something|anything|nothing|someone)\s+to\s+[a-z]+\b/.test(lower)){
add("Setelah need + something perlu to")
sug=sug.replace(/\bneed\s+(something|anything|nothing|someone)\s+([a-z]+)/i,"need $1 to $2")
}

// ===== ISSUES =====
let issueBox=document.getElementById("issues")
if(issues.length){
issueBox.innerHTML="<div class='title'>Issues</div>"+issues.map(x=>"‚ùå "+x).join("<br>")
}else{
issueBox.innerHTML="<div class='title'>Issues</div><div class='good'>‚úî Tidak ada masalah utama</div>"
}
issueBox.style.display="block"

// ===== REWRITE + MEANING =====
let rewriteBox=document.getElementById("rewrite")
let meaningBox=document.getElementById("meaning")

let finalSentence=(sug!==text)?sug:text
finalSentence=cap(finalSentence)
if(!/[.!?]$/.test(finalSentence)) finalSentence+="."

if(sug!==text){
rewriteBox.innerHTML="<div class='title'>Rewrite</div><div class='suggestion'>"+finalSentence+"</div>"
rewriteBox.style.display="block"
}else{
rewriteBox.style.display="none"
}

translateToIndo(finalSentence).then(m=>{
if(m){
meaningBox.innerHTML="<div class='title'>Meaning</div><div class='suggestion'>"+m+"</div>"
meaningBox.style.display="block"
}
})

}

// ===== ENTER = ANALYZE =====
document.getElementById("sentence").addEventListener("keydown",function(e){
if(e.key==="Enter"&&!e.shiftKey){
e.preventDefault()
analyze()
}
})

</script>
</body>
</html>