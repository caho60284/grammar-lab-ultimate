<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Grammar Lab Ultimate</title>

<style>
body{
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
background:#f4f6f5;
margin:0;
padding:24px;
color:#1f2d2a;
}

.container{
max-width:720px;
margin:auto;
}

h1{
font-size:40px;
margin-bottom:6px;
color:#3e5f53;
}

.subtitle{
color:#7b8e87;
margin-bottom:24px;
font-size:18px;
}

textarea{
width:100%;
padding:18px;
font-size:18px;
border-radius:18px;
border:2px solid #cfd8d5;
resize:none;
outline:none;
}

button{
width:100%;
margin-top:18px;
padding:18px;
font-size:20px;
border:none;
border-radius:30px;
background:#5d786e;
color:white;
cursor:pointer;
}

.card{
background:white;
border-radius:22px;
padding:22px;
margin-top:26px;
box-shadow:0 6px 20px rgba(0,0,0,.05);
}

.analysis{
background:#eef1ef;
border-radius:16px;
padding:16px;
margin-top:14px;
}

.label{
font-weight:600;
}

.stars{
color:#f5c518;
font-size:22px;
margin-top:10px;
}
</style>
</head>

<body>
<div class="container">

<h1>üß† Grammar Lab Ultimate</h1>
<div class="subtitle">Structure + POS + tense + naturalness + AI</div>

<textarea id="input" rows="3" placeholder="Type sentence..."></textarea>
<button onclick="analyze()">Analyze</button>

<div id="result" class="card" style="display:none">
<div id="sentence"></div>
<div id="meaning" style="margin-top:10px"></div>

<div class="analysis" id="analysisBox"></div>

<div class="stars" id="stars"></div>

<div id="native" style="margin-top:12px"></div>
</div>

</div>

<script>

async function translate(text){
try{
let r=await fetch("https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=id&dt=t&q="+encodeURIComponent(text))
let j=await r.json()
return j[0]?.map(x=>x[0]).join("")||""
}catch{return ""}
}

function detectClause(words){
let markers=["because","that","if","when","while","although","since","who","which"]
for(let m of markers){
let i=words.indexOf(m)
if(i>0) return words.slice(i).join(" ")
}
return "-"
}

function detectModal(words){
let modals=["can","could","will","would","shall","should","may","might","must"]
for(let w of words){
if(modals.includes(w)) return w
}
return "-"
}

function detectCopula(words){
let cop=["am","is","are","was","were"]
for(let w of words){
if(cop.includes(w)) return w
}
return null
}

function detectVerb(words){
let mod=detectModal(words)
if(mod!="-") return mod

let cop=detectCopula(words)
if(cop) return cop

for(let w of words){
if(w.endsWith("ed")||w.endsWith("ing")||w.endsWith("s")) return w
}

return "-"
}

function detectTense(words){
if(words.includes("was")||words.includes("were")) return "past"
if(words.includes("had")) return "past"
if(words.includes("will")) return "future"
if(words.includes("could")||words.includes("would")||words.includes("should")) return "modal past"
return "present"
}

function detectObject(words,verbIndex){
if(verbIndex<0||verbIndex>=words.length-1) return "-"
return words.slice(verbIndex+1).join(" ")
}

function colorize(words){
let html=""
words.forEach((w,i)=>{
let color=["#5b8def","#e05d44","#5bbf8a","#8b6bd6","#f2a93b"][i%5]
html+=`<span style="color:${color};font-weight:600">${w}</span> `
})
return html
}

async function analyze(){
let text=document.getElementById("input").value.trim()
if(!text) return

let meaning=await translate(text)

let words=text.toLowerCase().replace(/[.,!?]/g,"").split(/\s+/)

let subject=words[0]||"-"
let modal=detectModal(words)
let verb=detectVerb(words)
let clause=detectClause(words)
let tense=detectTense(words)

let verbIndex=words.indexOf(verb)
let object=detectObject(words,verbIndex)

let natural=5

document.getElementById("result").style.display="block"
document.getElementById("sentence").innerHTML=colorize(words)
document.getElementById("meaning").innerHTML="<b>Arti:</b> "+(meaning||"(gagal)")

document.getElementById("analysisBox").innerHTML=`
<div><span class="label">Subject:</span> ${subject}</div>
<div><span class="label">Modal:</span> ${modal}</div>
<div><span class="label">Verb:</span> ${verb}</div>
<div><span class="label">Object:</span> ${object}</div>
<div><span class="label">Clause:</span> ${clause}</div>
<div><span class="label">Tense:</span> ${tense}</div>
`

document.getElementById("stars").innerText="‚≠ê".repeat(natural)
document.getElementById("native").innerHTML="<b>Native:</b> "+text
}

</script>
</body>
</html>