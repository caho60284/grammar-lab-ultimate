<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Grammar Lab Expert</title>

<style>
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif}
body{margin:0;background:#f4f8f6}
header{background:#fff;padding:16px;box-shadow:0 2px 6px rgba(0,0,0,.06)}
h1{margin:0;color:#1f7a5c}
.sub{font-size:13px;color:#6b7280}

.container{padding:16px;max-width:900px;margin:auto}

textarea{
width:100%;min-height:100px;padding:12px;
border-radius:12px;border:1px solid #ddd;font-size:16px
}

button{
margin-top:10px;background:#1f7a5c;color:#fff;
border:none;border-radius:10px;padding:10px 14px;font-size:15px
}

.card{
background:#fff;border-radius:14px;padding:14px;margin-top:14px;
box-shadow:0 2px 6px rgba(0,0,0,.05)
}

.title{font-weight:700;color:#1f7a5c;margin-bottom:6px}
.issue{color:#c0392b;margin:3px 0}
.good{color:#1f7a5c}
.suggestion{background:#ecfdf5;padding:10px;border-radius:10px;margin-top:6px;font-style:italic}
</style>
</head>

<body>

<header>
<h1>üß† Grammar Lab Expert</h1>
<div class="sub">Syntactic grammar analyzer offline</div>
</header>

<div class="container">

<textarea id="sentence" placeholder="Tempel kalimat Inggris..."></textarea>

<script>
document.getElementById("sentence").addEventListener("keydown", function(e){
  if(e.key === "Enter" && !e.shiftKey){
    e.preventDefault()
    analyze()
  }
})
</script>
<button onclick="analyze()">Analisis</button>

<div id="syntax" class="card" style="display:none"></div>
<div id="issues" class="card" style="display:none"></div>
<div id="suggestion" class="card" style="display:none"></div>

</div>

<script>

// ===== BASIC LEXICON =====
const infinitiveVerbs=["want","need","plan","decide","try","hope","learn","refuse"]
const beForms=["am","is","are","was","were","be","been"]
const modals=["can","could","may","might","must","should","will","would"]
const pastMap={go:"went",eat:"ate",see:"saw",do:"did",make:"made"}

// ===== TOKENIZE =====
function tokenize(t){
return t.toLowerCase().replace(/[.,!?]/g,"").split(/\s+/)
}

// ===== SUBJECT DETECT =====
function detectSubject(tokens){
const pronouns=["i","you","he","she","we","they"]
for(let i=0;i<tokens.length;i++){
if(pronouns.includes(tokens[i])) return tokens[i]
}
return tokens[0]||""
}

// ===== MAIN VERB DETECT =====
function detectVerb(tokens){
for(let t of tokens){
if(infinitiveVerbs.includes(t)) return t
if(Object.keys(pastMap).includes(t)) return t
if(modals.includes(t)) return t
}
return tokens[1]||""
}

// ===== CLAUSE DETECT =====
function detectClause(text){
if(/\balthough|because|if|when|while\b/i.test(text))
return "Subordinate clause"
return "Simple clause"
}

// ===== ANALYZE =====
function analyze(){

let text=document.getElementById("sentence").value.trim()
if(!text) return

let tokens=tokenize(text)
let lower=text.toLowerCase()

let subject=detectSubject(tokens)
let verb=detectVerb(tokens)
let clause=detectClause(text)

let syntaxBox=document.getElementById("syntax")
syntaxBox.innerHTML=`
<div class="title">Syntax</div>
<div>Subject: ${subject||"-"}</div>
<div>Main verb: ${verb||"-"}</div>
<div>Clause type: ${clause}</div>
`
syntaxBox.style.display="block"

let issues=[]
let sug=text

function add(msg){issues.push(msg)}

// ===== INFINITIVE COMPLEMENT =====
infinitiveVerbs.forEach(v=>{
let r=new RegExp(`\\b${v}\\s+[a-z]+`)
if(r.test(lower) && !new RegExp(`\\b${v}\\s+to\\s+`).test(lower)){
add(`Verb complement: "${v}" harus diikuti to-infinitive`)
sug=sug.replace(new RegExp(`${v}\\s+([a-z]+)`,"i"),`${v} to $1`)
}
})

// ===== BE MISSING =====
if(/\b(i|he|she|they|we)\s+(tired|hungry|happy|sad)\b/.test(lower)){
add("Missing be-verb before adjective")
sug=sug.replace(/\b(i|he|she|they|we)\s+(tired|hungry|happy|sad)\b/i,"$1 am $2")
}

// ===== POLARITY =====
if(/\banything\b/.test(lower) && !/\bnot|never|n't\b/.test(lower)){
add("Polarity: anything dipakai di negatif/interogatif")
sug=sug.replace(/anything/i,"something")
}

// ===== TENSE =====
if(/\byesterday|ago|last\b/.test(lower)){
for(let v in pastMap){
if(new RegExp(`\\b${v}\\b`).test(lower)){
add("Tense mismatch with past marker")
sug=sug.replace(new RegExp(v,"i"),pastMap[v])
}
}
}

// ===== MODAL BASE FORM =====
modals.forEach(m=>{
let r=new RegExp(`\\b${m}\\s+([a-z]+ing)`)
if(r.test(lower)){
add("Modal harus diikuti base verb (tanpa -ing)")
sug=sug.replace(new RegExp(`${m}\\s+([a-z]+)ing`,"i"),`${m} $1`)
}
})

// ===== FEEL COMPLEMENT =====
if(/\bfeel\s+[a-z]+ing\b/.test(lower) && !/\bfeel\s+like\s+[a-z]+ing\b/.test(lower)){
add('Verb complement: "feel" harus diikuti adjective atau "like + ing"')
sug=sug.replace(/\bfeel\s+([a-z]+ing)/i,"feel like $1")
}

// ===== OUTPUT =====
let issueBox=document.getElementById("issues")
if(issues.length){
issueBox.innerHTML="<div class='title'>Issues</div>"+issues.map(x=>"‚ùå "+x).join("<br>")
}else{
issueBox.innerHTML="<div class='title'>Issues</div><div class='good'>‚úî Tidak ada masalah utama</div>"
}
issueBox.style.display="block"

let sugBox=document.getElementById("suggestion")
if(sug!==text){
sug=sug.charAt(0).toUpperCase()+sug.slice(1)
if(!/[.!?]$/.test(sug)) sug+="."
sugBox.innerHTML="<div class='title'>Rewrite</div><div class='suggestion'>"+sug+"</div>"
sugBox.style.display="block"
}else{
sugBox.style.display="none"
}

}

</script>
</body>
</html>
